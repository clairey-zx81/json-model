# Backlog v2

## Current Tasks

- [x] all: remove dynamic compiler code, tests and doc.
- [x] tests: values with name field
- [x] static: xor code generation
- [x] c-backend: issue with "$xxx" properties, `char*` is not `json_t*` (`ex_08 ex_09`)
- [x] py-backend: improve url validation
- [x] frontent: add `-T 1000` to trigger measuring performance.
- [x] static: unique constraint
- [ ] tests: refactor all tests with `pytest` to avoid SSD file delete/create cycles (wip)
- [ ] static: cmp constraint implementation
- [ ] py-backend: heterogeneous enum (`enum_05`)
- [ ] c-backend: heterogeneous enum (`enum_05`)
- [ ] c-backend: also prefix type name and extensions with `jm_`
- [ ] static: multi-type object disjunction?
- [ ] c-backend: unique for scalars using `constant_t`
- [ ] c-backend: fast `$REGEX` implementation (wip)
- [ ] py-backend: unique for any
- [ ] py-backend: unique for scalars (`set` only works for str)
- [ ] py-backend: non-str enum with `ConstSet`
- [ ] c-backend: report missing must property names by reinvestigating.
- [ ] backend: move python-specifics from `language.py` to `python.py`
- [ ] tests: remove SO stuff
- [ ] python: remove `static.py`
- [ ] command: remove `-S`
- [ ] doc: remove about S
- [ ] python: drop `Validator` class
- [ ] schema: add explicit `"$schema"` property if appropriate

## To Do

- [ ] project: establish priority
- [ ] design: improve meta model with more predefs? regex recursion extension? `"/^/$REGEX/\$/v"`
- [ ] design: more predefs: `"$EMAIL"`, `"$URI"`
- [ ] frontend: accept raw sequence of values? list of values?
- [ ] project: improve backlog management with thematic sections
- [ ] design: $-refs may only appear in defs for simpler compiler AND better readability?
- [ ] project: move all code's TODO here
- [ ] py-backend: multi-type enum `enum_05`
- [ ] static: if loose, cast all int constants to double?
- [ ] static: keep model comments in generated code?
- [ ] c-backend: add arr and obj to cst management?
- [ ] c-backend: more separate headers to avoid unused warnings.
- [ ] c-backend: add a common prefix to all internal functions.
- [ ] design: allow regular extension to use references `/...($XXX).../R`
- [ ] design: should it allow unexpected ints as constants?
- [ ] dynamic: JSON IR to lambda?!
- [ ] backend: add JSON IR
- [ ] backend: direct code for blaze?
- [ ] dynamic: rely on static and eval
- [ ] frontend: add multi-level naming option
- [ ] backend: report errors
- [ ] optim: ultimate type on loose should yield `float`
- [ ] static: abstract imperative language code generation (wip)
- [ ] c-backend: see [jansson](https://jansson.readthedocs.io/en/latest/), avoid cJSON
- [ ] c-backend: predefs for $DATE, $URL, $REGEX
- [ ] backend: do not generate intermediate empty functions for direct objects?
- [ ] backend: do not generate intermediate empty functions for property values when possible
- [ ] backend: reduce/minimize language abstraction? `T_var_val`?
- [ ] backend: rethink function boundaries?
- [ ] backend: rethink `with_report` and `with_path`, keep the former only?
- [ ] c-backend: add support for `re2` wrapper?
- [ ] backend: name-based selector optimized for root.
- [ ] perfs: measure performance against blaze benchmark for openapi at least
- [ ] python: refactor in preproc tools…
- [ ] tests: optimized openapi-310-models should have fully removed schema stuff
- [ ] optim: remove unused introduced names `__external_...`
- [ ] optim: remove unused names at depth 1 and more?
- [ ] optim: remove unused local (not exported) definitions?
- [ ] static: fix `modval/_untyped*` with `value_len` when type is unknown
- [ ] static: detect and remove duplicate functions!
- [ ] static: generate pyright compatible code…
- [ ] tests: remove unstable DO output? remove empty lines?
- [ ] design: handle `.` and `/` references as relative url
- [ ] design: namespace, only some defs exported, and cannot have multi-level refs `$r#N#xxx`?
- [ ] python: use mandatory keyword parameters where appropriate
- [ ] feature: `--extension openapi` to activate an extension ? default `none`, `moschin`…
- [ ] design: add convention for local vs exported definitions? capital?
- [ ] static: separate compilation of included models
- [ ] command: add option to do/skip check of `~` model
- [ ] feature: control url caching, change dir location or disable
- [ ] feature: cache expiration?
- [ ] feature: improve error messages, eg missing "$" on a URL reference
- [ ] feature: restrict definitions as proper identifiers
- [ ] tests: re-check some results of json schema analysis paper
- [ ] feature: self trafo example, eg create a variant between local defs
- [ ] tests: measure coverage
- [ ] feature: simplify lib usage wrt script-like features with some functions
- [ ] feature: full inline of externals to generate a working model without includes
- [ ] feature: check/forbid/allow url references with an anchor
- [ ] python: refactor and cleanup
- [ ] static: remove spurious newlines
- [ ] tests: move/add more tests to rwt, modval, bads
- [ ] tests: what if a trafo adds/replaces an external reference, is it resolved?
- [ ] tests: fix tests in `bads/wip`?
- [ ] tests: parallelism with `pytest`?
- [ ] tests: add github CI
- [ ] tests: raise coverage, possibly to 100%?
- [ ] tests: skip url cache while testing
- [ ] tests: move Makefile tasks as `pytest` items with target content as reference
- [ ] output: improve `-P` to have a re-intrant model (see also: inline)
- [ ] output: prettyprint rejection reasons?
- [ ] feature: direct validator
- [ ] feature: static/dynamic js/ts compiler?
- [ ] feature: (limited) pydantic export?
- [ ] feature: integrate or remove `stats`?
- [ ] feature: think about code integration in a realistic project? usability? doc?
- [ ] design: (online) extension register?
- [ ] doc: check and document API entry points
- [ ] extend: direct forms for instance, eg types, constraints, layout? see [FormBuilder](https://formbuilder.online/).
- [ ] extend: direct relational mapping? (eg foreign key/primary key/unique)
- [ ] extend: direct object creation (Python pydantic, JS)?
- [ ] extend: ORM support, eg in the Python ecosystem, see `SQLAlchemy` and `Django`?
- [ ] extend: data structure _documentation_
- [ ] extend: accepting any extension?! eg opened objects?
- [ ] extend: variants, see `models/json-schema-*`
- [ ] extend: pg storage, extension
- [ ] extend: mongodb storage ?
- [ ] perf: schema validation on yac data
- [ ] perf: open data, eg RNCP and FRESQ
- [ ] frontend: loop load/valid for perf
- [ ] perf: reuse blaze data set where possible (implies schema to model)
- [ ] design: conditionals or not conditionals… eg for interfaces?
      if not in the description language, it should be easy to express outside.
- [ ] doc: create a clean documentation, following Diátaxis (tuto | howto / explain | reference).
- [ ] doc: setup mkdocs
- [ ] doc: tutorial which mimics [json schema](https://tour.json-schema.org/)?
- [ ] research: paper themes? extensions, compilation (CGO tools), ...?
- [ ] feature: use actual JSON path spec for transformations with a filter for applying changes
- [ ] pr: register `json-model.org`? use `github.io`?
- [ ] pr: article submission about data structure trafo? validation performance? high-level IR?
      perf is important because value validation is pure (useless) in-depth overhead in practice.
- [ ] perf: two phase check, without collection and with collection if needed.
- [ ] perf: no reasons/path collection and run with collection only when bad.
- [ ] schema: handle includes? inline?!
- [ ] static: what about a specialize IR [Blaze](https://arxiv.org/abs/2503.02770)?
- [ ] static: prioritize ts/js for usability, c for speed.
- [ ] js/ts-backend: look at JSON Schema implementations?
- [ ] dyn-backend: is dynamic mergeable in xstatic, beyond using `eval`?
- [ ] rust-backend: see [json crate](https://docs.rs/json/latest/json/).
- [ ] cpp-backend: see [json](https://github.com/nlohmann/json) and `re2`.
- [ ] java-backend: see [jackson](https://github.com/FasterXML/jackson).
- [ ] kotlin-backend: see [serialization](https://kotlinlang.org/docs/serialization.html).
- [ ] go-backend: encoding/json vs various faster replacements…
- [ ] feature: add model predef for URI, URI-REF and the like
- [ ] design: URI vs URL?
- [ ] service: json to lang conversion API :-)
- [ ] command: allow direct compilation with cc-like options?

## Done

- [x] refactor: move schema to model conversion to json-schema-utils.
- [x] design: change `%` to `$` and remove `$` intra-model naming shortcut.
- [x] design: name space decision, there is only one name space per file. trafo path are exceptions?
- [x] ~design: readability and style: `:verbose` version of single char keywords!? (see extensions)~
- [x] design: clarify stuff inside the root `#`? or use `%` for specific purpose?
- [x] design: extension for preprocessed (merged and trafo).
- [x] dynamic: python compiler
- [x] static: python compiler
- [x] design: variants, i.e. form in progress vs final form with more constraints?
- [x] design: extensions could allow synonyms enabling JSON Model l10n?
- [x] tests: declaration of the meta model?
- [x] feature: accept js suffix as input, possibly removing comments.
- [x] feature: add `--auto` option to automatically extract url mappings
- [x] static: generate separate `check_model` root function and simplify code.
- [x] tests: recheck existing tests in rwt
- [x] static: deterministic set output
- [x] dynamic: fix output instability
- [x] python: pyright
- [x] python: ruff
- [x] python: flake8
- [x] refactor: move basic script pre processing as functions
- [x] tests: test schemas and values with jsu
- [x] extend: `.schema` extension to add JSON Schema specific stuff, and `.mo` and `.in`
- [x] tests: rename without explicit `-v2`
- [x] python: remove global list in Symbols
- [x] tests: move bads up
- [x] tests: move bads data to bads directory
- [x] feature: use `-` for standard input and output
- [x] feature: yaml file input
- [x] tests: working `make check`
- [x] tests: make check for bads
- [x] tests: add malformed bad models
- [x] tests: with an actual url! (hello2)
- [x] python: rename `types.py` which is a pain
- [x] feature: yaml url input
- [x] tests: True/False -> PASS/FAIL
- [x] ~feature: how to remove a definition? nope, must be nullified (eg `$NONE`) because refs~
- [x] tests: upgrade all models in `models/` and check them as well
- [x] tests: add expected "$schema" value to schema models
- [x] static: do not inline unused support function (`is_valid_*` and possibly others)
- [x] schema: control keyword sorting to put type-related stuff on top (-ns)
- [x] static: use mandatory keyword parameters where appropriate
- [x] feature: clarify and implement options management `JSON_MODEL_…`
- [x] feature: allow scalar value for `/`
- [x] schema: test output json schema (strict) conformity
- [x] command: use exclusive options where appropriate
- [x] tests: check all models wrt to the meta model, once
- [x] static: remove pyright asserts from generated code
- [x] schema: warn when generating schema with strict options
- [x] pr: submit with _JSU_ as JSON Schema tool (export feature) (_PR 1636_)
- [x] static: add option to report where it fails (aka reasons)
- [x] static: fast vs slow with path and reasons (if rep is _None_)
- [x] static: update path
- [x] feature: --format yaml to show yaml instead of json
- [x] design: official (meta) model url: ~`https://models.json-model.org/...`~ vs `https://json-model.org/models/...`
- [x] static: optimize simple regex cases (from Blaze paper)
- [x] python: remove global list in JsonModel
- [x] python: remove all globals in Symbols and JsonModel
- [x] static: generate executable script with minimal main
- [x] command: add option `-J` to show json IR, set default to `-P` (preprocessed)
- [x] command: change default to `-ns` (unsorted json properties)
- [x] command: also use prettyprint options for yaml generation
- [x] static: add a `_` to the default prefix to separate exports
- [x] static: rename all internal stuff with a `_` prefix
- [x] python: refactor in optim analyze merge…
- [x] feature: warn when mixing loose/strict int/float
- [x] feature: implement `$UUID` predef
- [x] backend: remove `decl_` variants
- [x] feature: make static compiled exported defs accessible…
- [x] frontend: select named model with `--name name`
- [x] frontend: use `--list` to show available models
- [x] command: add option `--name` to control name of generated function
- [x] frontend: add `--version` or `-v` to show jmc version
- [x] backend: add free
- [x] backend: no path option generation in `Language`
- [x] c-backend: path previous and next, and back and forth scan
- [x] c-backend: add report collection with path
- [x] frontend: add option `-r` to collect report.
- [x] input: accept raw js, not just json with comments
- [x] c-backend: main API does not need to know about internal structs.
- [x] frontend: report init errors.
- [x] py-backend: fix nested if in inlined code generation.
- [x] c-backend: unique shortcut while sorting
- [x] c-backend: json anything comparison for sorting and searching
- [x] static: constant string and int enum
- [x] c-backend: unique for any
- [x] static: or implementation
- [x] static: object disjunction on str
- [x] static: support or constants, aka enum.
- [x] static: object disjunction on int, bool, float, null
- [x] command: allow value checking under `-X -F py`
- [x] api: load model from file, load model from string…
- [x] py-frontend: handle test vector files
- [x] c-frontend: handle test vector files
- [x] c-backend: separate headers and functions to allow compiling a support library.
- [x] backend: move runtime in a runtime directory.
- [x] backend: working c and py "$REGEX".
- [x] tests: check test vector files
- [x] py-backend: import runtime.
- [x] static: generate separate lib
- [x] backend: clarify runtime vs data.
- [x] c-backend: fix `-l` implementation.
