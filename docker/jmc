#! /bin/bash
#
# run jmc command in docker
#

docker_root="docker run --name awesome_jmc_$$ -v .:/app/workspace --rm"
docker_user="$docker_root --user $(id -u):$(id -g)"

if [ "$#" -ge 1 -a "$1" = "help" ] ; then
  echo "$0 [ help | run | exec | shell | root ] â€¦"
elif [ "$#" -ge 1 -a "$1" = "shell" ] ; then
  shift 1
  exec $docker_user -i --entrypoint /bin/bash zx80/jmc "$@"
elif [ "$#" -ge 1 -a "$1" = "root" ] ; then
  shift 1
  exec $docker_root -i --entrypoint /bin/bash zx80/jmc "$@"
elif [ "$#" -ge 1 -a "$1" = "exec" ] ; then
  exe=$2
  shift 2
  exec $docker_user --entrypoint "$exe" zx80/jmc "$@"
elif [ "$#" -ge 1 -a "$1" = "run" ] ; then
  shift 1
  exec $docker_user zx80/jmc "$@"
else
  exec $docker_user zx80/jmc "$@"
fi
