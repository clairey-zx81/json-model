#
# Docker-in-docker example image run, try --help to see available options:
#
# docker run --rm --name imperial_jmcbench \
#   -v /var/run/docker.sock:/var/run/docker.sock \
#   -v .:/workspace \
#   -e WORKDIR=$PWD \
#   -e JMC_OPTS=--no-predef \
#       zx80/jmc-bench:latest \
#           -p 20 -l 10000 --env JMC_OPTS --jmc=latest --cap-py
#
FROM docker.io/alpinelinux/docker-cli:latest
LABEL description="JSON Model compiler benchmarking artifact (docker-in-docker)"
RUN apk add git bash bash-completion sqlite jq lscpu pythonispython3
RUN mkdir /app /workspace && chmod a+rx /app /workspace
COPY . /app
RUN chmod a+r /app/* && chmod a+x /app/*.sh /app/*.py /app/jmc /app/js-cli
ENV PATH=$PATH:/app
WORKDIR /workspace
ENV POD=docker
ENTRYPOINT [ "/app/benchmark.sh" ]
